CREATE EXTENSION dummy_toaster;
CREATE TABLE tst_failed (
	t text TOASTER dummy_toaster TOASTER dummy_toaster
);
ERROR:  multiple TOASTER clauses not allowed
CREATE TABLE tst1 (
	f text STORAGE plain,
	t text STORAGE external TOASTER dummy_toaster,
	l int
);
SELECT  setseed(0);
 setseed 
---------
 
(1 row)

INSERT INTO tst1
	SELECT repeat('a', 2000)::text as f, t.t as t, length(t.t) as l FROM
		(SELECT
			repeat(random()::text, (20+30*random())::int) as t
		 FROM
			generate_series(1, 32) as  i) as t;
SELECT length(t), l, length(t) = l FROM tst1 ORDER BY 1, 3;
 length |  l  | ?column? 
--------+-----+----------
    391 | 391 | t
    414 | 414 | t
    437 | 437 | t
    442 | 442 | t
    448 | 448 | t
    450 | 450 | t
    540 | 540 | t
    540 | 540 | t
    551 | 551 | t
    558 | 558 | t
    594 | 594 | t
    612 | 612 | t
    630 | 630 | t
    646 | 646 | t
    648 | 648 | t
    648 | 648 | t
    665 | 665 | t
    666 | 666 | t
    684 | 684 | t
    702 | 702 | t
    738 | 738 | t
    738 | 738 | t
    741 | 741 | t
    756 | 756 | t
    756 | 756 | t
    774 | 774 | t
    792 | 792 | t
    798 | 798 | t
    833 | 833 | t
    836 | 836 | t
    855 | 855 | t
    882 | 882 | t
(32 rows)

SELECT attnum, attname, atttypid, attstorage, tsrname 
	FROM pg_attribute, pg_toaster t
	WHERE attrelid = 'tst1'::regclass and attnum>0 and t.oid = atttoaster
	ORDER BY attnum;
 attnum | attname | atttypid | attstorage |    tsrname    
--------+---------+----------+------------+---------------
      1 | f       |       25 | p          | deftoaster
      2 | t       |       25 | e          | dummy_toaster
(2 rows)

CREATE TABLE tst2 (
	t text
);
SELECT attnum, attname, atttypid, attstorage, tsrname 
	FROM pg_attribute, pg_toaster t
	WHERE attrelid = 'tst2'::regclass and attnum>0 and t.oid = atttoaster
	ORDER BY attnum;
 attnum | attname | atttypid | attstorage |  tsrname   
--------+---------+----------+------------+------------
      1 | t       |       25 | x          | deftoaster
(1 row)

ALTER TABLE tst2 ALTER COLUMN t SET TOASTER dummy_toaster;
SELECT attnum, attname, atttypid, attstorage, tsrname 
	FROM pg_attribute, pg_toaster t
	WHERE attrelid = 'tst2'::regclass and attnum>0 and t.oid = atttoaster
	ORDER BY attnum;
 attnum | attname | atttypid | attstorage |    tsrname    
--------+---------+----------+------------+---------------
      1 | t       |       25 | x          | dummy_toaster
(1 row)

CREATE TABLE tst3 (
	f text STORAGE external TOASTER deftoaster,
	t text STORAGE external TOASTER dummy_toaster,
	l int
);

alter table tst3 add id serial;

INSERT INTO tst3
	SELECT repeat('a', 2000)::text as f, t.t as t, length(t.t) as l FROM
		(SELECT
			repeat(random()::text, (20+30*random())::int) as t
		 FROM
			generate_series(1, 32) as  i) as t;
SELECT length(t), l, length(t) = l FROM tst1 ORDER BY 1, 3;

SELECT attnum, attname, atttypid, attstorage, tsrname 
	FROM pg_attribute, pg_toaster t
	WHERE attrelid = 'tst3'::regclass and attnum>0 and t.oid = atttoaster
	ORDER BY attnum;
 attnum | attname | atttypid | attstorage |    tsrname    
--------+---------+----------+------------+---------------
      1 | f       |       25 | e          | deftoaster
      2 | t       |       25 | e          | dummy_toaster


update tst3 set f = repeat('b', 2000)::text;
update tst3 set t = repeat('c', 2000)::text;
ERROR:  Data <1667457891> size exceeds MAX_DUMMY_CHUNK_SIZE <1024>


ALTER TABLE tst3 ALTER COLUMN f SET TOASTER dummy_toaster;
update tst3 set f = repeat('d', 2000)::text;
ERROR:  Data <1684300900> size exceeds MAX_DUMMY_CHUNK_SIZE <1024>


ALTER TABLE tst3 ALTER COLUMN t SET TOASTER deftoaster;
update tst3 set t = repeat('e', 2000)::text;

SELECT l, left(f,20), left(t,20) FROM tst3;
  l  |         left         |         left
-----+----------------------+----------------------
 378 | dddddddddddddddddddd | eeeeeeeeeeeeeeeeeeee
 817 | dddddddddddddddddddd | eeeeeeeeeeeeeeeeeeee
 665 | dddddddddddddddddddd | eeeeeeeeeeeeeeeeeeee
 646 | dddddddddddddddddddd | eeeeeeeeeeeeeeeeeeee
 396 | dddddddddddddddddddd | eeeeeeeeeeeeeeeeeeee
 760 | dddddddddddddddddddd | eeeeeeeeeeeeeeeeeeee
 702 | dddddddddddddddddddd | eeeeeeeeeeeeeeeeeeee
 468 | dddddddddddddddddddd | eeeeeeeeeeeeeeeeeeee
 720 | dddddddddddddddddddd | eeeeeeeeeeeeeeeeeeee
 798 | dddddddddddddddddddd | eeeeeeeeeeeeeeeeeeee
 760 | dddddddddddddddddddd | eeeeeeeeeeeeeeeeeeee
 648 | dddddddddddddddddddd | eeeeeeeeeeeeeeeeeeee
 558 | dddddddddddddddddddd | eeeeeeeeeeeeeeeeeeee
 810 | dddddddddddddddddddd | eeeeeeeeeeeeeeeeeeee
 504 | dddddddddddddddddddd | eeeeeeeeeeeeeeeeeeee
 594 | dddddddddddddddddddd | eeeeeeeeeeeeeeeeeeee
 703 | dddddddddddddddddddd | eeeeeeeeeeeeeeeeeeee
 558 | dddddddddddddddddddd | eeeeeeeeeeeeeeeeeeee
 540 | dddddddddddddddddddd | eeeeeeeeeeeeeeeeeeee
 666 | dddddddddddddddddddd | eeeeeeeeeeeeeeeeeeee
 627 | dddddddddddddddddddd | eeeeeeeeeeeeeeeeeeee
 528 | dddddddddddddddddddd | eeeeeeeeeeeeeeeeeeee
 468 | dddddddddddddddddddd | eeeeeeeeeeeeeeeeeeee
 594 | dddddddddddddddddddd | eeeeeeeeeeeeeeeeeeee
 456 | dddddddddddddddddddd | eeeeeeeeeeeeeeeeeeee
 608 | dddddddddddddddddddd | eeeeeeeeeeeeeeeeeeee
 494 | dddddddddddddddddddd | eeeeeeeeeeeeeeeeeeee
 810 | dddddddddddddddddddd | eeeeeeeeeeeeeeeeeeee
 414 | dddddddddddddddddddd | eeeeeeeeeeeeeeeeeeee
 741 | dddddddddddddddddddd | eeeeeeeeeeeeeeeeeeee
 774 | dddddddddddddddddddd | eeeeeeeeeeeeeeeeeeee
 522 | dddddddddddddddddddd | eeeeeeeeeeeeeeeeeeee
(32 rows)

SELECT attnum, attname, atttypid, attstorage, tsrname 
	FROM pg_attribute, pg_toaster t
	WHERE attrelid = 'tst3'::regclass and attnum>0 and t.oid = atttoaster
	ORDER BY attnum;
 attnum | attname | atttypid | attstorage |    tsrname    
--------+---------+----------+------------+---------------
      1 | f       |       25 | e          | dummy_toaster
      2 | t       |       25 | e          | deftoaster

\d+ tst3
                                                               Table "public.tst3"
 Column |  Type   | Collation | Nullable |             Default              | Storage  |    Toaster    | Compression | Stats target | Description
--------+---------+-----------+----------+----------------------------------+----------+---------------+-------------+--------------+-------------
 f      | text    |           |          |                                  | plain    | deftoaster    |             |              |
 t      | text    |           |          |                                  | external | dummy_toaster |             |              |
 l      | integer |           |          |                                  | plain    |               |             |              |
 id     | integer |           | not null | nextval('tst3_id_seq'::regclass) | plain    |               |             |              |


\d+ tst1
                                            Table "public.tst1"
 Column |  Type   | Collation | Nullable | Default | Storage  |    Toaster    | Stats target | Description 
--------+---------+-----------+----------+---------+----------+---------------+--------------+-------------
 f      | text    |           |          |         | plain    | deftoaster    |              | 
 t      | text    |           |          |         | external | dummy_toaster |              | 
 l      | integer |           |          |         | plain    |               |              | 

\d+ tst2
                                          Table "public.tst2"
 Column | Type | Collation | Nullable | Default | Storage  |    Toaster    | Stats target | Description 
--------+------+-----------+----------+---------+----------+---------------+--------------+-------------
 t      | text |           |          |         | extended | dummy_toaster |              | 

\d+ tst3
                                                               Table "public.tst3"
 Column |  Type   | Collation | Nullable |             Default              | Storage  |    Toaster    | Compression | Stats target | Description
--------+---------+-----------+----------+----------------------------------+----------+---------------+-------------+--------------+-------------
 f      | text    |           |          |                                  | plain    | dummy_toaster |             |              |
 t      | text    |           |          |                                  | external | deftoaster    |             |              |
 l      | integer |           |          |                                  | plain    |               |             |              |
 id     | integer |           | not null | nextval('tst3_id_seq'::regclass) | plain    |               |             |              |
